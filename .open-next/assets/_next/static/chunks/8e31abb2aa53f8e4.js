(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,30257,e=>{"use strict";var t=e.i(43476),s=e.i(71645),r=e.i(18566),a=e.i(22016);function l(){var e;let l,o=(0,r.useRouter)(),[i,n]=(0,s.useState)(null),[d,c]=(0,s.useState)([]),[x,m]=(0,s.useState)([]),[h,u]=(0,s.useState)(!0),[g,p]=(0,s.useState)("locations");(0,s.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/auth/me");if(!e.ok)return void o.push("/login");let t=await e.json();n(t.user);let s=await fetch("/api/locations");if(s.ok){let e=await s.json();c(e.locations)}if("free"!==t.user.subscriptionTier){let e=await fetch("/api/alerts");if(e.ok){let t=await e.json();m(t.alerts)}}}catch(e){console.error("Failed to fetch dashboard data:",e)}finally{u(!1)}})()},[o]);let b=async e=>{if(confirm("Are you sure you want to delete this location?"))try{(await fetch(`/api/locations?id=${e}`,{method:"DELETE"})).ok&&c(d.filter(t=>t.id!==e))}catch(e){console.error("Failed to delete location:",e)}},j=async(e,t)=>{try{(await fetch("/api/alerts",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,active:!t})})).ok&&m(x.map(s=>s.id===e?{...s,active:!t}:s))}catch(e){console.error("Failed to toggle alert:",e)}},f=async e=>{if(confirm("Are you sure you want to delete this alert?"))try{(await fetch(`/api/alerts?id=${e}`,{method:"DELETE"})).ok&&m(x.filter(t=>t.id!==e))}catch(e){console.error("Failed to delete alert:",e)}};if(h)return(0,t.jsx)("div",{className:"min-h-[calc(100vh-4rem)] bg-gray-50 flex items-center justify-center",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(!i)return null;let v=(e=i.subscriptionTier,(l={free:{color:"bg-gray-100 text-gray-800",maxLocations:3,hasAlerts:!1},enthusiast:{color:"bg-green-100 text-green-800",maxLocations:10,hasAlerts:!0},professional:{color:"bg-blue-100 text-blue-800",maxLocations:100,hasAlerts:!0},enterprise:{color:"bg-purple-100 text-purple-800",maxLocations:1e3,hasAlerts:!0}})[e]||l.free);return(0,t.jsx)("div",{className:"min-h-[calc(100vh-4rem)] bg-gray-50 py-8",children:(0,t.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,t.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden mb-8",children:[(0,t.jsx)("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 px-8 py-6",children:(0,t.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h1",{className:"text-2xl font-bold text-white",children:["Welcome back, ",i.fullName||i.email.split("@")[0]]}),(0,t.jsx)("p",{className:"text-blue-100 mt-1",children:"Manage your saved locations and alerts"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium capitalize ${v.color}`,children:[i.subscriptionTier," Plan"]}),"free"===i.subscriptionTier&&(0,t.jsx)(a.default,{href:"/pricing",className:"inline-flex items-center px-4 py-2 bg-white text-blue-600 rounded-lg font-medium hover:bg-blue-50 transition-colors",children:"Upgrade"})]})]})}),(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 divide-x divide-gray-200 border-b border-gray-200",children:[(0,t.jsxs)("div",{className:"px-6 py-4 text-center",children:[(0,t.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:d.length}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Saved Locations"})]}),(0,t.jsxs)("div",{className:"px-6 py-4 text-center",children:[(0,t.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:v.maxLocations}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Location Limit"})]}),(0,t.jsxs)("div",{className:"px-6 py-4 text-center",children:[(0,t.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:x.length}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Active Alerts"})]}),(0,t.jsxs)("div",{className:"px-6 py-4 text-center",children:[(0,t.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:new Date(i.createdAt).toLocaleDateString("en-US",{month:"short",year:"numeric"})}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Member Since"})]})]})]}),(0,t.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden",children:[(0,t.jsx)("div",{className:"border-b border-gray-200",children:(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsxs)("button",{onClick:()=>p("locations"),className:`flex-1 px-6 py-4 text-sm font-medium transition-colors ${"locations"===g?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:["ðŸ“ Saved Locations (",d.length,")"]}),(0,t.jsxs)("button",{onClick:()=>p("alerts"),disabled:!v.hasAlerts,className:`flex-1 px-6 py-4 text-sm font-medium transition-colors ${"alerts"===g?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"} ${!v.hasAlerts?"opacity-50 cursor-not-allowed":""}`,children:["ðŸ”” Alerts (",x.length,")",!v.hasAlerts&&(0,t.jsx)("span",{className:"ml-2 text-xs bg-gray-200 text-gray-600 px-2 py-0.5 rounded",children:"Upgrade"})]})]})}),(0,t.jsxs)("div",{className:"p-6",children:["locations"===g&&(0,t.jsx)(t.Fragment,{children:0===d.length?(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsxs)("svg",{className:"w-16 h-16 mx-auto text-gray-300 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No saved locations"}),(0,t.jsx)("p",{className:"text-gray-500 mb-6",children:"Start by exploring the map and saving locations you want to monitor."}),(0,t.jsx)(a.default,{href:"/explore",className:"inline-flex items-center px-6 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors",children:"Explore the Map"})]}):(0,t.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:d.map(e=>(0,t.jsxs)("div",{className:"border border-gray-200 rounded-xl p-4 hover:border-blue-300 hover:shadow-md transition-all",children:[(0,t.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,t.jsx)("h3",{className:"font-semibold text-gray-900 truncate flex-1",children:e.name}),(0,t.jsx)("button",{onClick:()=>b(e.id),className:"text-gray-400 hover:text-red-500 transition-colors ml-2",children:(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),e.address&&(0,t.jsx)("p",{className:"text-sm text-gray-500 mb-2 truncate",children:e.address}),(0,t.jsxs)("p",{className:"text-xs text-gray-400 font-mono mb-3",children:[e.latitude.toFixed(4),"Â°, ",e.longitude.toFixed(4),"Â°"]}),e.watershedHuc12&&(0,t.jsxs)("p",{className:"text-xs text-blue-600 mb-3",children:["HUC-12: ",e.watershedHuc12]}),(0,t.jsxs)(a.default,{href:`/explore?lat=${e.latitude}&lng=${e.longitude}`,className:"inline-flex items-center text-sm text-blue-600 hover:text-blue-700 font-medium",children:["View on Map",(0,t.jsx)("svg",{className:"w-4 h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]},e.id))})}),"alerts"===g&&v.hasAlerts&&(0,t.jsx)(t.Fragment,{children:0===x.length?(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)("svg",{className:"w-16 h-16 mx-auto text-gray-300 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})}),(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No alerts configured"}),(0,t.jsx)("p",{className:"text-gray-500 mb-6",children:"Set up alerts to get notified about floods, low flow, and water quality issues."})]}):(0,t.jsx)("div",{className:"space-y-4",children:x.map(e=>{var s;return(0,t.jsx)("div",{className:`border rounded-xl p-4 ${e.active?"border-green-200 bg-green-50":"border-gray-200 bg-gray-50"}`,children:(0,t.jsxs)("div",{className:"flex justify-between items-start",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,t.jsx)("span",{className:"font-medium text-gray-900",children:{flood:"ðŸŒŠ Flood Warning",low_flow:"ðŸ’§ Low Flow",water_quality:"ðŸ§ª Water Quality",contamination:"â˜¢ï¸ Contamination"}[s=e.alertType]||s}),(0,t.jsx)("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ${e.active?"bg-green-100 text-green-800":"bg-gray-200 text-gray-600"}`,children:e.active?"Active":"Paused"})]}),e.locationName&&(0,t.jsxs)("p",{className:"text-sm text-gray-600",children:["ðŸ“ ",e.locationName]}),e.thresholdValue&&(0,t.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:["Threshold: ",e.thresholdValue," ",e.thresholdUnit]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("button",{onClick:()=>j(e.id,e.active),className:`p-2 rounded-lg transition-colors ${e.active?"bg-green-100 text-green-600 hover:bg-green-200":"bg-gray-200 text-gray-600 hover:bg-gray-300"}`,children:e.active?(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"})}):(0,t.jsxs)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]})}),(0,t.jsx)("button",{onClick:()=>f(e.id),className:"p-2 rounded-lg bg-red-100 text-red-600 hover:bg-red-200 transition-colors",children:(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})},e.id)})})})]})]})]})})}e.s(["default",()=>l])}]);