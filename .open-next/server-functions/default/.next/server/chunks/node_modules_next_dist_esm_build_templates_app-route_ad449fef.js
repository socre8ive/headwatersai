module.exports=[46987,e=>{"use strict";var t=e.i(47909),a=e.i(74017),i=e.i(96250),r=e.i(59756),s=e.i(61916),n=e.i(14444),o=e.i(37092),l=e.i(69741),c=e.i(16795),d=e.i(87718),u=e.i(95169),p=e.i(47587),g=e.i(66012),h=e.i(70101),f=e.i(26937),y=e.i(10372),R=e.i(93695);e.i(52474);var C=e.i(220),m=e.i(89171),w=e.i(37037);let _="https://echodata.epa.gov/echo";async function v(e,t,a,i){let r=`${_}/cwa_rest_services.get_facilities?output=JSON&p_c1lat=${t}&p_c1lon=${e}&p_c2lat=${i}&p_c2lon=${a}&p_ptype=NPD`,s=await fetch(r);if(!s.ok)throw Error(`EPA ECHO API error: ${s.status}`);return N(await s.json())}async function S(e){let t=`${_}/cwa_rest_services.get_facilities?output=JSON&p_huc=${e}&p_ptype=NPD`,a=await fetch(t);if(!a.ok)throw Error(`EPA ECHO API error: ${a.status}`);return N(await a.json())}async function E(e,t,a){let i=`${_}/cwa_rest_services.get_facilities?output=JSON&p_lat=${e}&p_long=${t}&p_radius=${a}&p_ptype=NPD`,r=await fetch(i);if(!r.ok)throw Error(`EPA ECHO API error: ${r.status}`);return N(await r.json())}function N(e){return e.Results?.Facilities?e.Results.Facilities.map(e=>({registryId:String(e.RegistryId||e.FacilityId||""),facilityName:String(e.FacilityName||e.Name||""),latitude:parseFloat(String(e.Latitude||e.FacLat||0)),longitude:parseFloat(String(e.Longitude||e.FacLong||0)),streetAddress:String(e.StreetAddress||e.Address||""),city:String(e.City||e.CityName||""),stateCode:String(e.State||e.StateCode||""),zipCode:String(e.Zip||e.ZipCode||""),facilityType:String(e.FacilityType||e.SICDesc||""),naicsCodes:A(e.NAICSCodes||e.NAICS),sicCodes:A(e.SICCodes||e.SIC),npdesPermitIds:A(e.NPDESIds||e.SourceID),isMajorDischarger:"Major"===e.CWAPermitStatus||"Y"===e.MajorFlag,complianceStatus:String(e.CWAComplianceStatus||e.ComplianceStatus||"Unknown"),lastInspectionDate:e.LastInspection?String(e.LastInspection):null,violationsLast3Years:parseInt(String(e.CWA3YrQtrStatus||e.Violations||0))||0})):[]}function A(e){return e?Array.isArray(e)?e.map(String):"string"==typeof e?e.split(",").map(e=>e.trim()).filter(Boolean):[]:[]}async function I(e){try{let t,{searchParams:a}=new URL(e.url),i=a.get("huc8"),r=a.get("lat"),s=a.get("lng"),n=a.get("radius"),o=a.get("west"),l=a.get("south"),c=a.get("east"),d=a.get("north");if(i)t=await S(i);else if(r&&s){let e=parseFloat(r),a=parseFloat(s),i=n?parseFloat(n):25;if(isNaN(e)||isNaN(a))return m.NextResponse.json({error:"Invalid coordinates"},{status:400});t=await E(e,a,i)}else{if(!o||!l||!c||!d)return m.NextResponse.json({error:"Either huc8, lat/lng with optional radius, or bounding box is required"},{status:400});let e={west:parseFloat(o),south:parseFloat(l),east:parseFloat(c),north:parseFloat(d)};if(Object.values(e).some(isNaN))return m.NextResponse.json({error:"Invalid bounding box coordinates"},{status:400});t=await v(e.west,e.south,e.east,e.north)}let u=await (0,w.getDB)();for(let e of t)await u.prepare(`INSERT OR REPLACE INTO epa_facilities
           (registry_id, facility_name, latitude, longitude, street_address, city,
            state_code, zip_code, facility_type, naics_codes, sic_codes, npdes_permit_ids,
            is_major_discharger, compliance_status, last_inspection_date,
            violations_last_3_years, cached_at)
           VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, datetime('now'))`).bind(e.registryId,e.facilityName,e.latitude,e.longitude,e.streetAddress,e.city,e.stateCode,e.zipCode,e.facilityType,JSON.stringify(e.naicsCodes),JSON.stringify(e.sicCodes),JSON.stringify(e.npdesPermitIds),+!!e.isMajorDischarger,e.complianceStatus,e.lastInspectionDate,e.violationsLast3Years).run();return m.NextResponse.json({success:!0,count:t.length,facilities:t.map(e=>({registryId:e.registryId,facilityName:e.facilityName,latitude:e.latitude,longitude:e.longitude,address:{street:e.streetAddress,city:e.city,state:e.stateCode,zip:e.zipCode},facilityType:e.facilityType,naicsCodes:e.naicsCodes,sicCodes:e.sicCodes,npdesPermitIds:e.npdesPermitIds,isMajorDischarger:e.isMajorDischarger,complianceStatus:e.complianceStatus,lastInspectionDate:e.lastInspectionDate,violationsLast3Years:e.violationsLast3Years}))})}catch(e){return console.error("Facilities API error:",e),m.NextResponse.json({error:"Failed to fetch facility data"},{status:500})}}e.s(["GET",()=>I],1746);var P=e.i(1746);let x=new t.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/facilities/route",pathname:"/api/facilities",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/facilities/route.ts",nextConfigOutput:"standalone",userland:P}),{workAsyncStorage:O,workUnitAsyncStorage:T,serverHooks:D}=x;function b(){return(0,i.patchFetch)({workAsyncStorage:O,workUnitAsyncStorage:T})}async function F(e,t,i){x.isDev&&(0,r.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let m="/api/facilities/route";m=m.replace(/\/index$/,"")||"/";let w=await x.prepare(e,t,{srcPage:m,multiZoneDraftMode:!1});if(!w)return t.statusCode=400,t.end("Bad Request"),null==i.waitUntil||i.waitUntil.call(i,Promise.resolve()),null;let{buildId:_,params:v,nextConfig:S,parsedUrl:E,isDraftMode:N,prerenderManifest:A,routerServerContext:I,isOnDemandRevalidate:P,revalidateOnlyGenerated:O,resolvedPathname:T,clientReferenceManifest:D,serverActionsManifest:b}=w,F=(0,l.normalizeAppPath)(m),j=!!(A.dynamicRoutes[F]||A.routes[T]),$=async()=>((null==I?void 0:I.render404)?await I.render404(e,t,E,!1):t.end("This page could not be found"),null);if(j&&!N){let e=!!A.routes[T],t=A.dynamicRoutes[F];if(t&&!1===t.fallback&&!e){if(S.experimental.adapterPath)return await $();throw new R.NoFallbackError}}let M=null;!j||x.isDev||N||(M="/index"===(M=T)?"/":M);let H=!0===x.isDev||!j,U=j&&!H;b&&D&&(0,n.setReferenceManifestsSingleton)({page:m,clientReferenceManifest:D,serverActionsManifest:b,serverModuleMap:(0,o.createServerModuleMap)({serverActionsManifest:b})});let L=e.method||"GET",k=(0,s.getTracer)(),q=k.getActiveScopeSpan(),K={params:v,prerenderManifest:A,renderOpts:{experimental:{authInterrupts:!!S.experimental.authInterrupts},cacheComponents:!!S.cacheComponents,supportsDynamicResponse:H,incrementalCache:(0,r.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:S.cacheLife,waitUntil:i.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,i)=>x.onRequestError(e,t,i,I)},sharedContext:{buildId:_}},B=new c.NodeNextRequest(e),z=new c.NodeNextResponse(t),J=d.NextRequestAdapter.fromNodeNextRequest(B,(0,d.signalFromNodeResponse)(t));try{let n=async e=>x.handle(J,K).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=k.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let i=a.get("next.route");if(i){let t=`${L} ${i}`;e.setAttributes({"next.route":i,"http.route":i,"next.span_name":t}),e.updateName(t)}else e.updateName(`${L} ${m}`)}),o=!!(0,r.getRequestMeta)(e,"minimalMode"),l=async r=>{var s,l;let c=async({previousCacheEntry:a})=>{try{if(!o&&P&&O&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let s=await n(r);e.fetchMetrics=K.renderOpts.fetchMetrics;let l=K.renderOpts.pendingWaitUntil;l&&i.waitUntil&&(i.waitUntil(l),l=void 0);let c=K.renderOpts.collectedTags;if(!j)return await (0,g.sendResponse)(B,z,s,K.renderOpts.pendingWaitUntil),null;{let e=await s.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(s.headers);c&&(t[y.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==K.renderOpts.collectedRevalidate&&!(K.renderOpts.collectedRevalidate>=y.INFINITE_CACHE)&&K.renderOpts.collectedRevalidate,i=void 0===K.renderOpts.collectedExpire||K.renderOpts.collectedExpire>=y.INFINITE_CACHE?void 0:K.renderOpts.collectedExpire;return{value:{kind:C.CachedRouteKind.APP_ROUTE,status:s.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:i}}}}catch(t){throw(null==a?void 0:a.isStale)&&await x.onRequestError(e,t,{routerKind:"App Router",routePath:m,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:P})},I),t}},d=await x.handleResponse({req:e,nextConfig:S,cacheKey:M,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:A,isRoutePPREnabled:!1,isOnDemandRevalidate:P,revalidateOnlyGenerated:O,responseGenerator:c,waitUntil:i.waitUntil,isMinimalMode:o});if(!j)return null;if((null==d||null==(s=d.value)?void 0:s.kind)!==C.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(l=d.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",P?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),N&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let u=(0,h.fromNodeOutgoingHttpHeaders)(d.value.headers);return o&&j||u.delete(y.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||u.get("Cache-Control")||u.set("Cache-Control",(0,f.getCacheControlHeader)(d.cacheControl)),await (0,g.sendResponse)(B,z,new Response(d.value.body,{headers:u,status:d.value.status||200})),null};q?await l(q):await k.withPropagatedContext(e.headers,()=>k.trace(u.BaseServerSpan.handleRequest,{spanName:`${L} ${m}`,kind:s.SpanKind.SERVER,attributes:{"http.method":L,"http.target":e.url}},l))}catch(t){if(t instanceof R.NoFallbackError||await x.onRequestError(e,t,{routerKind:"App Router",routePath:F,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:P})}),j)throw t;return await (0,g.sendResponse)(B,z,new Response(null,{status:500})),null}}e.s(["handler",()=>F,"patchFetch",()=>b,"routeModule",()=>x,"serverHooks",()=>D,"workAsyncStorage",()=>O,"workUnitAsyncStorage",()=>T],46987)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_ad449fef.js.map